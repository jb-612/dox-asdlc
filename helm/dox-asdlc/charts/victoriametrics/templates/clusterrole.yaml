{{- if and .Values.enabled .Values.vmagent.enabled }}
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: {{ include "victoriametrics.vmagent.fullname" . }}
  labels:
    {{- include "victoriametrics.vmagent.labels" . | nindent 4 }}
rules:
  # Read access for pod discovery
  - apiGroups: [""]
    resources:
      - pods
      - services
      - endpoints
    verbs: ["get", "list", "watch"]
  # Read access for node labels (useful for node-level metrics)
  - apiGroups: [""]
    resources:
      - nodes
    verbs: ["get", "list", "watch"]
  # Read access for node metrics
  - apiGroups: [""]
    resources:
      - nodes/metrics
    verbs: ["get"]
{{- end }}
